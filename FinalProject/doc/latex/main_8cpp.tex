\hypertarget{main_8cpp}{\section{main.\-cpp File Reference}
\label{main_8cpp}\index{main.\-cpp@{main.\-cpp}}
}
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$avr/io.\-h$>$}\\*
{\ttfamily \#include $<$avr/wdt.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include \char`\"{}Free\-R\-T\-O\-S.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}task.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}queue.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}croutine.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}rs232int.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}time\-\_\-stamp.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}taskbase.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}textqueue.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}taskqueue.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}taskshare.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}shares.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}task\-\_\-user.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}task\-\_\-power.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}task\-\_\-control.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}task\-\_\-sensor.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}task\-\_\-steer.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{main_8cpp_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
Text\-Queue $\ast$ \hyperlink{main_8cpp_acd99bf5d187d4809af2f460a5415e904}{p\-\_\-print\-\_\-ser\-\_\-queue}
\begin{DoxyCompactList}\small\item\em This define prevents this .h file from being included multiple times in a .cpp file. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_aacc570f48cbc8d62d6b506da980e5b36}{Task\-Share$<$ int8\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_aacc570f48cbc8d62d6b506da980e5b36}{sh\-\_\-power\-\_\-set\-\_\-flag}}\label{main_8cpp_aacc570f48cbc8d62d6b506da980e5b36}

\begin{DoxyCompactList}\small\item\em Flag share indicating power value has changed. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_a5aa2903e32574844afb823db851e91d8}{Task\-Share$<$ int8\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a5aa2903e32574844afb823db851e91d8}{sh\-\_\-braking\-\_\-full\-\_\-flag}}\label{main_8cpp_a5aa2903e32574844afb823db851e91d8}

\begin{DoxyCompactList}\small\item\em Flag share indicating full braking requested. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_a997260f75507d382d25524c0b6716b9c}{Task\-Share$<$ volatile uint16\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a997260f75507d382d25524c0b6716b9c}{sh\-\_\-encoder\-\_\-count\-\_\-1}}\label{main_8cpp_a997260f75507d382d25524c0b6716b9c}

\begin{DoxyCompactList}\small\item\em Encoder counts\-:Motor 1 encoder count. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_a88f2240863fddb31a613dded6ad871f8}{Task\-Share$<$ volatile uint16\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a88f2240863fddb31a613dded6ad871f8}{sh\-\_\-encoder\-\_\-count\-\_\-2}}\label{main_8cpp_a88f2240863fddb31a613dded6ad871f8}

\begin{DoxyCompactList}\small\item\em Motor 1. \end{DoxyCompactList}\item 
Task\-Share$<$ volatile uint8\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a1b679af79d73c380a7f0b4d49dcbc755}{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-1}
\begin{DoxyCompactList}\small\item\em Motor 2. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_a777c7d499330fafba2cc196945515342}{Task\-Share$<$ volatile uint8\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a777c7d499330fafba2cc196945515342}{sh\-\_\-encoder\-\_\-new\-\_\-state\-\_\-1}}\label{main_8cpp_a777c7d499330fafba2cc196945515342}

\begin{DoxyCompactList}\small\item\em Previous state. \end{DoxyCompactList}\item 
Task\-Share$<$ volatile uint8\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_af00b9d68b516e076df875afe7a1dfe96}{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-2}
\begin{DoxyCompactList}\small\item\em Next state. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_a13e98b1ac77ef295fc268c40ce3cc94b}{Task\-Share$<$ volatile uint8\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a13e98b1ac77ef295fc268c40ce3cc94b}{sh\-\_\-encoder\-\_\-new\-\_\-state\-\_\-2}}\label{main_8cpp_a13e98b1ac77ef295fc268c40ce3cc94b}

\begin{DoxyCompactList}\small\item\em Previous state. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_a3a001b79cba5f9ae19b693e3c53440f3}{Task\-Share$<$ volatile uint32\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a3a001b79cba5f9ae19b693e3c53440f3}{sh\-\_\-motor\-\_\-1\-\_\-speed}}\label{main_8cpp_a3a001b79cba5f9ae19b693e3c53440f3}

\begin{DoxyCompactList}\small\item\em Next state. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_a31eb6c02bf5693d0d71e54f240bb01e7}{Task\-Share$<$ volatile uint32\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a31eb6c02bf5693d0d71e54f240bb01e7}{sh\-\_\-motor\-\_\-2\-\_\-speed}}\label{main_8cpp_a31eb6c02bf5693d0d71e54f240bb01e7}

\begin{DoxyCompactList}\small\item\em Motor 1. \end{DoxyCompactList}\item 
Task\-Share$<$ uint16\-\_\-t $>$ $\ast$ \hyperlink{main_8cpp_a1c714115d37fc602de04b1e93f2a63ae}{sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-1}
\begin{DoxyCompactList}\small\item\em Tick jump error count. \end{DoxyCompactList}\item 
\hypertarget{main_8cpp_a9ebd2476f8d88889d5a44476ca0db8fc}{Task\-Share$<$ uint16\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-2}}\label{main_8cpp_a9ebd2476f8d88889d5a44476ca0db8fc}

\item 
\hypertarget{main_8cpp_a8b0ab2b68dc2b2cea8b99ad5dc97b9a3}{Task\-Share$<$ int32\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-setpoint\-\_\-1}}\label{main_8cpp_a8b0ab2b68dc2b2cea8b99ad5dc97b9a3}

\item 
\hypertarget{main_8cpp_a4acd8ac38b5d31d06d9589a3284a46d6}{Task\-Share$<$ int32\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-setpoint\-\_\-2}}\label{main_8cpp_a4acd8ac38b5d31d06d9589a3284a46d6}

\item 
\hypertarget{main_8cpp_ab7a76a16c6c2a812898cde13d46beeac}{Task\-Share$<$ int16\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-\-P\-I\-D\-\_\-1\-\_\-power}}\label{main_8cpp_ab7a76a16c6c2a812898cde13d46beeac}

\item 
\hypertarget{main_8cpp_a89c366d7f5bdf64fd6068780a89d98aa}{Task\-Share$<$ int16\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-\-P\-I\-D\-\_\-2\-\_\-power}}\label{main_8cpp_a89c366d7f5bdf64fd6068780a89d98aa}

\item 
\hypertarget{main_8cpp_a4a895d9ec96fa193c705c8db7258bd19}{Task\-Share$<$ uint8\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-\-P\-I\-D\-\_\-control}}\label{main_8cpp_a4a895d9ec96fa193c705c8db7258bd19}

\item 
\hypertarget{main_8cpp_a9f0f2de1c2f3565369ae01bbc7daa8b4}{Task\-Share$<$ uint16\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-servo\-\_\-setpoint}}\label{main_8cpp_a9f0f2de1c2f3565369ae01bbc7daa8b4}

\item 
\hypertarget{main_8cpp_ae651cf7b6a54a426d12aac6f775a8099}{Task\-Share$<$ uint8\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-path\-\_\-radius}}\label{main_8cpp_ae651cf7b6a54a426d12aac6f775a8099}

\item 
\hypertarget{main_8cpp_a8256273d85ac41f64cb2a84e5e1a5b27}{Task\-Share$<$ uint8\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-circular\-\_\-start}}\label{main_8cpp_a8256273d85ac41f64cb2a84e5e1a5b27}

\item 
\hypertarget{main_8cpp_a850d997be035b52989ff5f4c416ad47c}{Task\-Share$<$ uint8\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-path\-\_\-velocity}}\label{main_8cpp_a850d997be035b52989ff5f4c416ad47c}

\item 
\hypertarget{main_8cpp_a8bb46290581252284d4e9619718f3d9c}{Task\-Share$<$ uint8\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-linear\-\_\-start}}\label{main_8cpp_a8bb46290581252284d4e9619718f3d9c}

\item 
\hypertarget{main_8cpp_ad497d6b0b8def3781c624cf854d61e41}{Task\-Share$<$ uint16\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-linear\-\_\-distance}}\label{main_8cpp_ad497d6b0b8def3781c624cf854d61e41}

\item 
\hypertarget{main_8cpp_aebb614a94b438243bfc50f4fe5be164f}{Task\-Share$<$ int32\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-heading\-\_\-setpoint}}\label{main_8cpp_aebb614a94b438243bfc50f4fe5be164f}

\item 
\hypertarget{main_8cpp_aef58fb33c98932d39c347ccef4bb6804}{Task\-Share$<$ int32\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-euler\-\_\-heading}}\label{main_8cpp_aef58fb33c98932d39c347ccef4bb6804}

\item 
\hypertarget{main_8cpp_ac5fe9b6dbd596e598c16c4c49d54d7a4}{Task\-Share$<$ uint8\-\_\-t $>$ $\ast$ {\bfseries sh\-\_\-imu\-\_\-status}}\label{main_8cpp_ac5fe9b6dbd596e598c16c4c49d54d7a4}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
This file contains the \hyperlink{main_8cpp_a840291bc02cba5474a4cb46a9b9566fe}{main()} code for a program which runs the M\-E405 board for M\-E405 lab 5.

Revisions\-: \begin{DoxyItemize}
\item 09-\/30-\/2012 J\-R\-R Original file was a one-\/file demonstration with two tasks \item 10-\/05-\/2012 J\-R\-R Split into multiple files, one for each task plus a main one \item 10-\/30-\/2012 J\-R\-R A hopefully somewhat stable version with global queue pointers and the new operator used for most memory allocation \item 11-\/04-\/2012 J\-R\-R Free\-R\-T\-O\-S Swoop demo program changed to a sweet test suite \item 01-\/05-\/2012 J\-R\-R Program reconfigured as M\-E405 Lab 1 starting point \item 03-\/28-\/2014 J\-R\-R Pointers to shared variables and queues changed to references \item 01-\/04-\/2015 J\-R\-R Names of share \& queue classes changed; allocated with new now \item April 28, 2016 -- B\-K\-K Added shared variables (encoder\-: count, state, error count), commented out task\-\_\-brightness\-: was interfering with channel 4 interrupts.\end{DoxyItemize}
License\-: This file is copyright 2015 by J\-R Ridgely and released under the Lesser G\-N\-U Public License, version 2. It intended for educational use only, but its use is not limited thereto. T\-H\-I\-S S\-O\-F\-T\-W\-A\-R\-E I\-S P\-R\-O\-V\-I\-D\-E\-D B\-Y T\-H\-E C\-O\-P\-Y\-R\-I\-G\-H\-T H\-O\-L\-D\-E\-R\-S A\-N\-D C\-O\-N\-T\-R\-I\-B\-U\-T\-O\-R\-S \char`\"{}\-A\-S I\-S\char`\"{} A\-N\-D A\-N\-Y E\-X\-P\-R\-E\-S\-S O\-R I\-M\-P\-L\-I\-E\-D W\-A\-R\-R\-A\-N\-T\-I\-E\-S, I\-N\-C\-L\-U\-D\-I\-N\-G, B\-U\-T N\-O\-T L\-I\-M\-I\-T\-E\-D T\-O, T\-H\-E I\-M\-P\-L\-I\-E\-D W\-A\-R\-R\-A\-N\-T\-I\-E\-S O\-F M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y A\-N\-D F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E A\-R\-E D\-I\-S\-C\-L\-A\-I\-M\-E\-D. I\-N N\-O E\-V\-E\-N\-T S\-H\-A\-L\-L T\-H\-E C\-O\-P\-Y\-R\-I\-G\-H\-T O\-W\-N\-E\-R O\-R C\-O\-N\-T\-R\-I\-B\-U\-T\-O\-R\-S B\-E L\-I\-A\-B\-L\-E F\-O\-R A\-N\-Y D\-I\-R\-E\-C\-T, I\-N\-D\-I\-R\-E\-C\-T, I\-N\-C\-I\-D\-E\-N\-T\-A\-L, S\-P\-E\-C\-I\-A\-L, E\-X\-E\-M\-P\-L\-A\-R\-Y, O\-R C\-O\-N\-S\-E\-Q\-U\-E\-N\-T\-I\-A\-L D\-A\-M\-A\-G\-E\-S (I\-N\-C\-L\-U\-D\-I\-N\-G, B\-U\-T N\-O\-T L\-I\-M\-I\-T\-E\-D T\-O, P\-R\-O\-C\-U\-R\-E\-M\-E\-N\-T O\-F S\-U\-B\-S\-T\-I\-T\-U\-T\-E G\-O\-O\-D\-S O\-R S\-E\-R\-V\-I\-C\-E\-S; L\-O\-S\-S O\-F U\-S\-E, D\-A\-T\-A, O\-R P\-R\-O\-F\-I\-T\-S; O\-R B\-U\-S\-I\-N\-E\-S\-S I\-N\-T\-E\-R\-R\-U\-P\-T\-I\-O\-N) H\-O\-W\-E\-V\-E\-R C\-A\-U\-S\-E\-D A\-N\-D O\-N A\-N\-Y T\-H\-E\-O\-R\-Y O\-F L\-I\-A\-B\-I\-L\-I\-T\-Y, W\-H\-E\-T\-H\-E\-R I\-N C\-O\-N\-T\-R\-A\-C\-T, S\-T\-R\-I\-C\-T L\-I\-A\-B\-I\-L\-I\-T\-Y, O\-R T\-O\-R\-T (I\-N\-C\-L\-U\-D\-I\-N\-G N\-E\-G\-L\-I\-G\-E\-N\-C\-E O\-R O\-T\-H\-E\-R\-W\-I\-S\-E) A\-R\-I\-S\-I\-N\-G I\-N A\-N\-Y W\-A\-Y O\-U\-T O\-F T\-H\-E U\-S\-E O\-F T\-H\-I\-S S\-O\-F\-T\-W\-A\-R\-E, E\-V\-E\-N I\-F A\-D\-V\-I\-S\-E\-D O\-F T\-H\-E P\-O\-S\-S\-I\-B\-I\-L\-I\-T\-Y O\-F S\-U\-C\-H D\-A\-M\-A\-G\-E. 

Definition in file \hyperlink{main_8cpp_source}{main.\-cpp}.



\subsection{Function Documentation}
\hypertarget{main_8cpp_a840291bc02cba5474a4cb46a9b9566fe}{\index{main.\-cpp@{main.\-cpp}!main@{main}}
\index{main@{main}!main.cpp@{main.\-cpp}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{main_8cpp_a840291bc02cba5474a4cb46a9b9566fe}
The main function sets up the R\-T\-O\-S. Some test tasks are created. Then the scheduler is started up; the scheduler runs until power is turned off or there's a reset. \begin{DoxyReturn}{Returns}
This is a real-\/time microcontroller program which doesn't return. 
\end{DoxyReturn}


Definition at line 122 of file main.\-cpp.



References p\-\_\-print\-\_\-ser\-\_\-queue, sh\-\_\-braking\-\_\-full\-\_\-flag, sh\-\_\-encoder\-\_\-count\-\_\-1, sh\-\_\-encoder\-\_\-count\-\_\-2, sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-1, sh\-\_\-encoder\-\_\-new\-\_\-state\-\_\-1, sh\-\_\-encoder\-\_\-new\-\_\-state\-\_\-2, sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-1, sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-2, sh\-\_\-motor\-\_\-1\-\_\-speed, sh\-\_\-motor\-\_\-2\-\_\-speed, and sh\-\_\-power\-\_\-set\-\_\-flag.



\subsection{Variable Documentation}
\hypertarget{main_8cpp_acd99bf5d187d4809af2f460a5415e904}{\index{main.\-cpp@{main.\-cpp}!p\-\_\-print\-\_\-ser\-\_\-queue@{p\-\_\-print\-\_\-ser\-\_\-queue}}
\index{p\-\_\-print\-\_\-ser\-\_\-queue@{p\-\_\-print\-\_\-ser\-\_\-queue}!main.cpp@{main.\-cpp}}
\subsubsection[{p\-\_\-print\-\_\-ser\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}Text\-Queue$\ast$ p\-\_\-print\-\_\-ser\-\_\-queue}}\label{main_8cpp_acd99bf5d187d4809af2f460a5415e904}


This define prevents this .h file from being included multiple times in a .cpp file. 

This is a print queue, descended from {\ttfamily emstream} so that things can be printed into the queue using the \char`\"{}$<$$<$\char`\"{} operator and they'll come out the other end as a stream of characters. It's used by tasks that send things to the user interface task to be printed. 

Definition at line 67 of file main.\-cpp.



Referenced by main(), and task\-\_\-user\-::run().

\hypertarget{main_8cpp_a1c714115d37fc602de04b1e93f2a63ae}{\index{main.\-cpp@{main.\-cpp}!sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-1@{sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-1}}
\index{sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-1@{sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-1}!main.cpp@{main.\-cpp}}
\subsubsection[{sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-1}]{\setlength{\rightskip}{0pt plus 5cm}Task\-Share$<$uint16\-\_\-t$>$$\ast$ sh\-\_\-encoder\-\_\-error\-\_\-count\-\_\-1}}\label{main_8cpp_a1c714115d37fc602de04b1e93f2a63ae}


Tick jump error count. 

Motor 2 

Definition at line 86 of file main.\-cpp.



Referenced by I\-S\-R(), and main().

\hypertarget{main_8cpp_a1b679af79d73c380a7f0b4d49dcbc755}{\index{main.\-cpp@{main.\-cpp}!sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-1@{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-1}}
\index{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-1@{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-1}!main.cpp@{main.\-cpp}}
\subsubsection[{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-1}]{\setlength{\rightskip}{0pt plus 5cm}Task\-Share$<$volatile uint8\-\_\-t$>$$\ast$ sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-1}}\label{main_8cpp_a1b679af79d73c380a7f0b4d49dcbc755}


Motor 2. 

Motor 1 encoder states 

Definition at line 77 of file main.\-cpp.



Referenced by encoder\-\_\-drv\-::encoder\-\_\-drv(), I\-S\-R(), and main().

\hypertarget{main_8cpp_af00b9d68b516e076df875afe7a1dfe96}{\index{main.\-cpp@{main.\-cpp}!sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-2@{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-2}}
\index{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-2@{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-2}!main.cpp@{main.\-cpp}}
\subsubsection[{sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-2}]{\setlength{\rightskip}{0pt plus 5cm}Task\-Share$<$volatile uint8\-\_\-t$>$$\ast$ sh\-\_\-encoder\-\_\-old\-\_\-state\-\_\-2}}\label{main_8cpp_af00b9d68b516e076df875afe7a1dfe96}


Next state. 

Motor 2 encoder states 

Definition at line 80 of file main.\-cpp.



Referenced by encoder\-\_\-drv\-::encoder\-\_\-drv(), I\-S\-R(), and main().

